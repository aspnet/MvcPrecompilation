<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$(MSBuildThisFileDirectory)..\common.targets" />
  <PropertyGroup>
    <MvcRazorRunCommand>dotnet</MvcRazorRunCommand>
    <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
    <_MvcViewCompilationBinaryPath Condition="'$(_MvcViewCompilationBinaryPath)'==''">$(MSBuildThisFileDirectory)../../lib/netcoreapp2.0/$(MSBuildThisFileName).dll</_MvcViewCompilationBinaryPath>
  </PropertyGroup>
  <Target
      Name="MvcRazorPrecompile"
      DependsOnTargets="_ResolveInputArguments"
      Inputs="@(MvcRazorFilesToCompile);@(IntermediateAssembly);@(DocFileItem);@(_DebugSymbolsIntermediatePath);@(ReferencePath);$(MSBuildAllProjects)"
      Outputs="$(_MvcRazorOutputFullPath)">

    <CallTarget Targets="_CreateResponseFileForMvcRazorPrecompile" />

    <PropertyGroup>
      <ExecArgs>--runtimeconfig &quot;$(ProjectRuntimeConfigFilePath)&quot;</ExecArgs>
      <ExecArgs>$(ExecArgs) --depsfile &quot;$(ProjectDepsFilePath)&quot;</ExecArgs>
      <ExecArgs>$(ExecArgs) &quot;$(_MvcViewCompilationBinaryPath)&quot;</ExecArgs>
      <ExecArgs>$(ExecArgs) @&quot;$(_MvcRazorResponseFilePath)&quot;</ExecArgs>
    </PropertyGroup>

    <Message
      Text="Executing Razor view precompilation."
      Importance="Low" />

    <Exec
      Command="$(MvcRazorRunCommand) exec $(ExecArgs)"
      WorkingDirectory="$(MSBuildProjectDirectory)" />

    <Message
      Text="Razor view compilation for $(MSBuildProjectName) -> $(_MvcRazorOutputFullPath)"
      Importance="High" />
  </Target>
</Project>